name: Create Docker Image

on:
    push:
        branches: ['main', 'feat/testing']
        paths:
            - '.github/workflows/deploy.yml'

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v2

            - name: Build docker image
              run: docker build -t frontend-technical:latest .

            - name: Build docker container
              run: docker run -d -p 3000:3000 frontend-technical

    test:
        needs: build
        runs-on: ubuntu-latest

        # steps:
        #     - name: Checkout repository
        #       uses: actions/checkout@v2

        #     - name: Cypress run
        #       uses: cypress-io/github-action@v5

        #     - name: Run Cypress tests
        #       run: |
        #           npm run cypress-prod-test
        #           npm run cypress-dev-test
        steps:
            - name: Checkout repository
              uses: actions/checkout@v2

            - name: Install dependencies
              run: npm install

            - name: Run Cypress tests
              run: npm run cypress-prod-test
